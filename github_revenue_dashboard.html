<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omsetning Dashboard 2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0f0f0f;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            color: #e4e4e7;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .title {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6, #06b6d4);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #9ca3af;
            font-weight: 400;
        }

        .loading {
            text-align: center;
            font-size: 1.1rem;
            color: #9ca3af;
            margin: 40px 0;
        }

        .error {
            background: #ef4444;
            color: white;
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(30, 30, 30, 0.8);
            border: 1px solid #374151;
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: #6366f1;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2);
        }

        .stat-label {
            font-size: 0.9rem;
            color: #9ca3af;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #f3f4f6;
        }

        .stat-change {
            font-size: 0.85rem;
            margin-top: 8px;
        }

        .positive { color: #10b981; }
        .negative { color: #ef4444; }
        .neutral { color: #6b7280; }

        .months-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .month-card {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid #374151;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .month-card:hover {
            transform: translateY(-2px);
            border-color: var(--accent-color);
        }

        .month-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-color);
        }

        .month-name {
            font-size: 0.9rem;
            color: #9ca3af;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .month-amount {
            font-size: 2.2rem;
            font-weight: 700;
            color: #f3f4f6;
            margin-bottom: 12px;
        }

        .month-progress {
            width: 100%;
            height: 8px;
            background: #374151;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .month-progress-bar {
            height: 100%;
            background: var(--accent-color);
            border-radius: 4px;
            transition: width 0.8s ease;
        }

        .month-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--accent-color);
            font-weight: 600;
        }

        .month-meta {
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 8px;
        }

        .quarterly-section {
            margin-bottom: 40px;
        }

        .quarterly-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #f3f4f6;
        }

        .quarterly-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .quarter-card {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid #374151;
        }

        .quarter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .quarter-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #f3f4f6;
        }

        .quarter-total {
            font-size: 1.8rem;
            font-weight: 700;
            color: #f3f4f6;
        }

        .quarter-average {
            font-size: 0.9rem;
            color: #9ca3af;
            margin-top: 4px;
        }

        .quarter-months {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .quarter-month {
            flex: 1;
            text-align: center;
            padding: 8px;
            background: rgba(55, 65, 81, 0.5);
            border-radius: 8px;
            font-size: 0.8rem;
        }

        .insights-section {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 16px;
            padding: 32px;
            border: 1px solid #374151;
        }

        .insights-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 24px;
            color: #f3f4f6;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
        }

        .insight-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .insight-icon {
            font-size: 1.5rem;
        }

        .insight-content {
            flex: 1;
        }

        .insight-label {
            font-size: 0.85rem;
            color: #9ca3af;
            margin-bottom: 4px;
        }

        .insight-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #f3f4f6;
        }

        .trend-up { color: #10b981; }
        .trend-down { color: #ef4444; }
        .trend-stable { color: #f59e0b; }

        .status-excellent { --accent-color: #10b981; }
        .status-good { --accent-color: #3b82f6; }
        .status-fair { --accent-color: #f59e0b; }
        .status-poor { --accent-color: #ef4444; }

        .data-source {
            text-align: center;
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 20px;
            padding: 10px;
            background: rgba(30, 30, 30, 0.5);
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .months-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-overview {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">ðŸ’° Omsetning Dashboard 2026</h1>
            <p class="subtitle">Fullstendig oversikt over mÃ¥nedlig og kvartalsvis utvikling</p>
        </header>

        <div id="loadingMessage" class="loading">Laster data...</div>
        <div id="errorMessage" class="error" style="display: none;"></div>

        <section class="stats-overview" id="statsOverview" style="display: none;">
            <div class="stat-card">
                <div class="stat-label">Total Omsetning</div>
                <div class="stat-value" id="totalRevenue">0 kr</div>
                <div class="stat-change" id="totalChange">Ingen data fra i fjor</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">MÃ¥nedlig Snitt</div>
                <div class="stat-value" id="avgRevenue">0 kr</div>
                <div class="stat-change" id="avgChange">Basert pÃ¥ data sÃ¥ langt</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Beste MÃ¥ned</div>
                <div class="stat-value" id="bestMonth">-</div>
                <div class="stat-change" id="bestAmount">0 kr</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">MÃ¥loppnÃ¥else</div>
                <div class="stat-value" id="goalProgress">0%</div>
                <div class="stat-change" id="goalStatus">av Ã¥rsmÃ¥l</div>
            </div>
        </section>

        <section class="months-grid" id="monthsGrid" style="display: none;">
            <!-- Months will be populated by JavaScript -->
        </section>

        <section class="quarterly-section" id="quarterlySection" style="display: none;">
            <h2 class="quarterly-title">ðŸ“Š Kvartalsvis Oversikt</h2>
            <div class="quarterly-grid" id="quartersGrid">
                <!-- Quarters will be populated by JavaScript -->
            </div>
        </section>

        <section class="insights-section" id="insightsSection" style="display: none;">
            <h2 class="insights-title">ðŸ“ˆ Innsikt & Analyse</h2>
            <div class="insights-grid" id="insightsGrid">
                <!-- Insights will be populated by JavaScript -->
            </div>
        </section>

        <div class="data-source">
            Data hentet fra: <span id="dataSourceUrl">JSON fil</span> | 
            Sist oppdatert: <span id="lastUpdated">-</span>
        </div>
    </div>

    <script>
        // ==============================
        // ðŸ”— DATA SOURCE CONFIGURATION
        // ==============================
        // Replace this URL with your public JSON file URL from Proton Drive or Google Drive
        const DATA_SOURCE_URL = 'https://raw.githubusercontent.com/hnorjordet/omsetningsdashbord/refs/heads/main/revenue_data.json';
        
        // Fallback data in case the JSON file can't be loaded
        const fallbackData = {
            januar: 0,
            februar: 0,
            mars: 0,
            april: 0,
            mai: 0,
            juni: 0,
            juli: 0,
            august: 0,
            september: 0,
            oktober: 0,
            november: 0,
            desember: 0,
            monthlyGoal: 40000,
            previousYearTotal: null,
            lastUpdated: "2026-01-01"
        };

        let revenueData = {};
        let monthlyGoal = 40000;
        let yearlyGoal = 480000;
        let previousYearTotal = null;

        // Month names and data
        const months = [
            'januar', 'februar', 'mars', 'april', 'mai', 'juni',
            'juli', 'august', 'september', 'oktober', 'november', 'desember'
        ];

        const monthNamesDisplay = [
            'Januar', 'Februar', 'Mars', 'April', 'Mai', 'Juni',
            'Juli', 'August', 'September', 'Oktober', 'November', 'Desember'
        ];

        // Data loading functions
        async function loadRevenueData() {
            try {
                const response = await fetch(DATA_SOURCE_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Update global variables
                monthlyGoal = data.monthlyGoal || 40000;
                yearlyGoal = monthlyGoal * 12;
                previousYearTotal = data.previousYearTotal || null;
                revenueData = { ...data };
                
                // Update data source display
                document.getElementById('dataSourceUrl').textContent = new URL(DATA_SOURCE_URL).hostname;
                document.getElementById('lastUpdated').textContent = data.lastUpdated || new Date().toISOString().split('T')[0];
                
                return true;
            } catch (error) {
                console.warn('Failed to load data from JSON file:', error);
                console.log('Using fallback data...');
                
                // Use fallback data
                revenueData = { ...fallbackData };
                monthlyGoal = fallbackData.monthlyGoal;
                yearlyGoal = monthlyGoal * 12;
                previousYearTotal = fallbackData.previousYearTotal;
                
                document.getElementById('dataSourceUrl').textContent = 'Fallback data (JSON file not accessible)';
                document.getElementById('lastUpdated').textContent = fallbackData.lastUpdated;
                
                return false;
            }
        }

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('nb-NO', {
                style: 'currency',
                currency: 'NOK',
                maximumFractionDigits: 0
            }).format(amount).replace('NOK', 'kr');
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('nb-NO').format(num);
        }

        function getMonthStatus(amount, goal) {
            const percentage = (amount / goal) * 100;
            if (amount === 0) return { class: 'status-poor', label: 'Ingen data', icon: 'â³', percentage: 0 };
            if (percentage >= 130) return { class: 'status-excellent', label: 'Fantastisk', icon: 'ðŸš€', percentage };
            if (percentage >= 110) return { class: 'status-excellent', label: 'Utmerket', icon: 'â­', percentage };
            if (percentage >= 90) return { class: 'status-good', label: 'Bra', icon: 'ðŸ‘', percentage };
            if (percentage >= 70) return { class: 'status-fair', label: 'OK', icon: 'ðŸ“ˆ', percentage };
            return { class: 'status-poor', label: 'Under mÃ¥l', icon: 'ðŸŽ¯', percentage };
        }

        function calculateStats(revenueData) {
            const values = Object.values(revenueData).filter(v => typeof v === 'number');
            const nonZeroValues = values.filter(v => v > 0);
            
            const total = values.reduce((sum, val) => sum + val, 0);
            const average = nonZeroValues.length ? total / nonZeroValues.length : 0;
            const currentMonthIndex = new Date().getMonth();
            const completedMonths = Math.min(currentMonthIndex + 1, nonZeroValues.length);
            
            // Find best and worst months
            let bestMonth = { name: '-', amount: 0, index: -1 };
            let worstMonth = { name: '-', amount: Infinity, index: -1 };
            
            months.forEach((month, idx) => {
                const amount = revenueData[month] || 0;
                if (amount > bestMonth.amount) {
                    bestMonth = { name: monthNamesDisplay[idx], amount, index: idx };
                }
                if (amount < worstMonth.amount && amount > 0 && idx <= currentMonthIndex) {
                    worstMonth = { name: monthNamesDisplay[idx], amount, index: idx };
                }
            });

            const goalProgress = (total / yearlyGoal) * 100;
            const projectedAnnual = completedMonths > 0 ? (total / completedMonths) * 12 : 0;

            return {
                total,
                average,
                bestMonth,
                worstMonth,
                goalProgress,
                projectedAnnual,
                completedMonths,
                remainingMonths: 12 - completedMonths
            };
        }

        function renderOverviewStats(revenueData) {
            const stats = calculateStats(revenueData);
            
            // Update total revenue
            document.getElementById('totalRevenue').textContent = formatCurrency(stats.total);
            
            // ==============================
            // ðŸ“Š YEAR-OVER-YEAR COMPARISON
            // ==============================
            const changeElement = document.getElementById('totalChange');
            
            if (previousYearTotal && previousYearTotal > 0) {
                const yearOverYearChange = ((stats.total - previousYearTotal) / previousYearTotal) * 100;
                const isPositive = yearOverYearChange >= 0;
                
                changeElement.textContent = `${isPositive ? '+' : ''}${yearOverYearChange.toFixed(1)}% fra i fjor`;
                changeElement.className = isPositive ? 'stat-change positive' : 'stat-change negative';
            } else {
                changeElement.textContent = 'Ingen data fra i fjor';
                changeElement.className = 'stat-change neutral';
            }
            
            // Update other stats
            document.getElementById('avgRevenue').textContent = formatCurrency(stats.average);
            document.getElementById('bestMonth').textContent = stats.bestMonth.name;
            document.getElementById('bestAmount').textContent = formatCurrency(stats.bestMonth.amount);
            document.getElementById('goalProgress').textContent = Math.round(stats.goalProgress) + '%';
            
            // Update goal status
            const goalStatus = document.getElementById('goalStatus');
            
            if (stats.projectedAnnual > yearlyGoal) {
                goalStatus.textContent = 'Ligger an til Ã¥ nÃ¥ mÃ¥let! ðŸŽ¯';
                goalStatus.className = 'stat-change positive';
            } else if (stats.projectedAnnual > yearlyGoal * 0.9) {
                goalStatus.textContent = 'NÃ¦r mÃ¥let ðŸ“ˆ';
                goalStatus.className = 'stat-change neutral';
            } else {
                goalStatus.textContent = 'Under Ã¥rsmÃ¥l âš ï¸';
                goalStatus.className = 'stat-change negative';
            }
        }

        function renderMonths(revenueData) {
            const grid = document.getElementById('monthsGrid');
            const currentMonth = new Date().getMonth();
            
            grid.innerHTML = months.map((month, index) => {
                const amount = revenueData[month] || 0;
                const status = getMonthStatus(amount, monthlyGoal);
                const isCurrentMonth = index === currentMonth;
                const isFutureMonth = index > currentMonth;
                
                return `
                    <div class="month-card ${status.class}">
                        <div class="month-name">
                            ${monthNamesDisplay[index]} ${isCurrentMonth ? '(InnevÃ¦rende)' : ''} ${isFutureMonth ? '(Kommende)' : ''}
                        </div>
                        <div class="month-amount">
                            ${amount > 0 ? formatCurrency(amount) : 'â€”'}
                        </div>
                        <div class="month-progress">
                            <div class="month-progress-bar" style="width: ${Math.min(status.percentage, 100)}%"></div>
                        </div>
                        <div class="month-status">
                            <span>${status.icon}</span>
                            <span>${status.label}</span>
                            ${amount > 0 ? `<span>(${Math.round(status.percentage)}%)</span>` : ''}
                        </div>
                        <div class="month-meta">
                            MÃ¥l: ${formatCurrency(monthlyGoal)}
                            ${amount > 0 ? ` â€¢ Differanse: ${formatCurrency(amount - monthlyGoal)}` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderQuarters(revenueData) {
            const grid = document.getElementById('quartersGrid');
            const quarters = [
                { name: 'Q1 2026', months: [0, 1, 2], label: 'Jan-Mar' },
                { name: 'Q2 2026', months: [3, 4, 5], label: 'Apr-Jun' },
                { name: 'Q3 2026', months: [6, 7, 8], label: 'Jul-Sep' },
                { name: 'Q4 2026', months: [9, 10, 11], label: 'Okt-Des' }
            ];

            grid.innerHTML = quarters.map(quarter => {
                const total = quarter.months.reduce((sum, monthIdx) => {
                    return sum + (revenueData[months[monthIdx]] || 0);
                }, 0);
                const average = total / 3;
                const hasData = quarter.months.some(monthIdx => (revenueData[months[monthIdx]] || 0) > 0);
                const quarterGoal = monthlyGoal * 3;
                const achievement = (total / quarterGoal) * 100;

                return `
                    <div class="quarter-card">
                        <div class="quarter-header">
                            <div>
                                <div class="quarter-name">${quarter.name}</div>
                                <div style="font-size: 0.8rem; color: #9ca3af;">${quarter.label}</div>
                            </div>
                        </div>
                        <div class="quarter-total">${hasData ? formatCurrency(total) : 'â€”'}</div>
                        <div class="quarter-average">
                            Snitt: ${hasData ? formatCurrency(average) : 'â€”'}
                            ${hasData ? ` â€¢ ${Math.round(achievement)}% av mÃ¥l` : ''}
                        </div>
                        <div class="quarter-months">
                            ${quarter.months.map(monthIdx => {
                                const amount = revenueData[months[monthIdx]] || 0;
                                return `
                                    <div class="quarter-month">
                                        <div style="font-size: 0.7rem; color: #9ca3af; margin-bottom: 4px;">
                                            ${monthNamesDisplay[monthIdx].substring(0, 3)}
                                        </div>
                                        <div style="font-weight: 600; color: ${amount > 0 ? '#f3f4f6' : '#6b7280'};">
                                            ${amount > 0 ? formatNumber(amount/1000) + 'k' : 'â€”'}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderInsights(revenueData) {
            const grid = document.getElementById('insightsGrid');
            const stats = calculateStats(revenueData);
            const values = months.map(month => revenueData[month] || 0).filter(v => v > 0);
            
            // Calculate trends
            const lastThreeMonths = values.slice(-3);
            const trend = lastThreeMonths.length >= 2 ? 
                (lastThreeMonths[lastThreeMonths.length - 1] > lastThreeMonths[0] ? 'up' : 
                 lastThreeMonths[lastThreeMonths.length - 1] < lastThreeMonths[0] ? 'down' : 'stable') : 'stable';

            const trendIcon = trend === 'up' ? 'ðŸ“ˆ' : trend === 'down' ? 'ðŸ“‰' : 'âž¡ï¸';
            const trendClass = `trend-${trend}`;
            const trendText = trend === 'up' ? 'Stigende' : trend === 'down' ? 'Fallende' : 'Stabil';

            const insights = [
                {
                    icon: 'ðŸŽ¯',
                    label: 'GjenstÃ¥ende til Ã¥rsmÃ¥l',
                    value: formatCurrency(Math.max(0, yearlyGoal - stats.total))
                },
                {
                    icon: 'ðŸ“Š',
                    label: 'Forventet Ã¥rlig omsetning',
                    value: formatCurrency(stats.projectedAnnual)
                },
                {
                    icon: trendIcon,
                    label: 'Trend siste mÃ¥neder',
                    value: trendText,
                    class: trendClass
                },
                {
                    icon: 'ðŸ“…',
                    label: 'MÃ¥neder igjen',
                    value: `${stats.remainingMonths} mÃ¥neder`
                },
                {
                    icon: 'ðŸ’ª',
                    label: 'NÃ¸dvendig per mÃ¥ned',
                    value: stats.remainingMonths > 0 ? formatCurrency((yearlyGoal - stats.total) / stats.remainingMonths) : 'MÃ¥l nÃ¥dd! ðŸŽ‰'
                },
                {
                    icon: 'ðŸ†',
                    label: 'Best vs Verst',
                    value: stats.worstMonth.amount > 0 ? `${Math.round((stats.bestMonth.amount / stats.worstMonth.amount) * 100)}% forskjell` : 'Ikke tilgjengelig'
                }
            ];

            grid.innerHTML = insights.map(insight => `
                <div class="insight-item">
                    <div class="insight-icon">${insight.icon}</div>
                    <div class="insight-content">
                        <div class="insight-label">${insight.label}</div>
                        <div class="insight-value ${insight.class || ''}">${insight.value}</div>
                    </div>
                </div>
            `).join('');
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function hideLoadingAndShowContent() {
            document.getElementById('loadingMessage').style.display = 'none';
            document.getElementById('statsOverview').style.display = 'grid';
            document.getElementById('monthsGrid').style.display = 'grid';
            document.getElementById('quarterlySection').style.display = 'block';
            document.getElementById('insightsSection').style.display = 'block';
        }

        function renderDashboard() {
            try {
                renderOverviewStats(revenueData);
                renderMonths(revenueData);
                renderQuarters(revenueData);
                renderInsights(revenueData);
                hideLoadingAndShowContent();
            } catch (error) {
                console.error('Error rendering dashboard:', error);
                showError('Feil ved visning av dashboard. Sjekk konsollen for detaljer.');
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                const dataLoaded = await loadRevenueData();
                if (!dataLoaded) {
                    showError('Kunne ikke laste data fra JSON-fil. Bruker fallback-data.');
                }
                renderDashboard();
            } catch (error) {
                console.error('Critical error initializing dashboard:', error);
                showError('Kritisk feil ved initialisering av dashboard.');
            }
        });
    </script>
</body>
</html>
