<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omsetning</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #191919;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #e4e4e7;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
        }

        .title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 0.9rem;
            color: #9ca3af;
        }

        .loading {
            text-align: center;
            font-size: 1.1rem;
            color: #9ca3af;
            margin: 40px 0;
        }

        .error {
            background: #ef4444;
            color: white;
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            border-color: #4a4a4a;
            transform: translateY(-2px);
        }

        .stat-label {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: #ffffff;
        }

        .quarters-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .quarter-card {
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .quarter-card:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .quarter-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent-color);
        }

        .quarter-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .quarter-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
        }

        .quarter-period {
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .quarter-status {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 8px;
            font-weight: 600;
        }

        .quarter-total {
            font-size: 1.6rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .quarter-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: #9ca3af;
        }

        .quarter-progress {
            width: 100%;
            height: 6px;
            background: #374151;
            border-radius: 3px;
            margin: 12px 0 8px 0;
            overflow: hidden;
        }

        .quarter-progress-bar {
            height: 100%;
            background: var(--accent-color);
            border-radius: 3px;
            transition: width 0.8s ease;
        }

        .quarter-months {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .quarter-month {
            flex: 1;
            background: rgba(55, 65, 81, 0.5);
            border-radius: 6px;
            padding: 8px;
            text-align: center;
            font-size: 0.75rem;
        }

        .quarter-month-name {
            color: #9ca3af;
            margin-bottom: 2px;
            text-transform: uppercase;
        }

        .quarter-month-value {
            color: #ffffff;
            font-weight: 600;
        }

        /* Status colors */
        .status-excellent { --accent-color: #10b981; background: rgba(16, 185, 129, 0.1); color: #10b981; }
        .status-good { --accent-color: #3b82f6; background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
        .status-fair { --accent-color: #f59e0b; background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
        .status-poor { --accent-color: #ef4444; background: rgba(239, 68, 68, 0.1); color: #ef4444; }

        .footer {
            text-align: center;
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 20px;
            padding: 10px;
            background: rgba(30, 30, 30, 0.5);
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            .quarters-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">ðŸ“Š Omsetning</h1>
            <p class="subtitle">Kompakt visning av omsetning per kvartal</p>
        </header>

        <div id="loadingMessage" class="loading">Laster data...</div>
        <div id="errorMessage" class="error" style="display: none;"></div>

        <section class="quick-stats" id="quickStats" style="display: none;">
            <div class="stat-card">
                <div class="stat-label">Total omsetning</div>
                <div class="stat-value" id="totalRevenue">0 kr</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">MÃ¥loppnÃ¥else</div>
                <div class="stat-value" id="goalProgress">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Beste kvartal</div>
                <div class="stat-value" id="bestQuarter">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Gjennomsnitt</div>
                <div class="stat-value" id="avgQuarter">0 kr</div>
            </div>
        </section>

        <section class="quarters-grid" id="quartersGrid" style="display: none;">
            <!-- Quarters will be populated by JavaScript -->
        </section>

        <footer class="footer">
            Data hentet fra: <span id="dataSourceUrl">JSON fil</span> | 
            Sist oppdatert: <span id="lastUpdated">-</span>
        </footer>
    </div>

    <script>
        // ==============================
        // ðŸ”— DATA SOURCE CONFIGURATION
        // ==============================
        const DATA_SOURCE_URL = 'https://raw.githubusercontent.com/hnorjordet/omsetningsdashbord/refs/heads/main/revenue_data.json';
        
        // Fallback data in case the JSON file can't be loaded
        const fallbackData = {
            januar: 0,
            februar: 0,
            mars: 0,
            april: 0,
            mai: 0,
            juni: 0,
            juli: 0,
            august: 0,
            september: 0,
            oktober: 0,
            november: 0,
            desember: 0,
            monthlyGoal: 40000,
            previousYearTotal: null,
            lastUpdated: "2026-01-01"
        };

        let revenueData = {};
        let monthlyGoal = 40000;
        let yearlyGoal = 480000;

        const months = [
            'januar', 'februar', 'mars', 'april', 'mai', 'juni',
            'juli', 'august', 'september', 'oktober', 'november', 'desember'
        ];

        const monthNamesDisplay = [
            'Jan', 'Feb', 'Mar', 'Apr', 'Mai', 'Jun',
            'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Des'
        ];

        // Data loading functions
        async function loadRevenueData() {
            try {
                const response = await fetch(DATA_SOURCE_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Update global variables
                monthlyGoal = data.monthlyGoal || 40000;
                yearlyGoal = monthlyGoal * 12;
                revenueData = { ...data };
                
                // Update data source display
                document.getElementById('dataSourceUrl').textContent = new URL(DATA_SOURCE_URL).hostname;
                document.getElementById('lastUpdated').textContent = data.lastUpdated || new Date().toISOString().split('T')[0];
                
                return true;
            } catch (error) {
                console.warn('Failed to load data from JSON file:', error);
                console.log('Using fallback data...');
                
                // Use fallback data
                revenueData = { ...fallbackData };
                monthlyGoal = fallbackData.monthlyGoal;
                yearlyGoal = monthlyGoal * 12;
                
                document.getElementById('dataSourceUrl').textContent = 'Fallback data (JSON file not accessible)';
                document.getElementById('lastUpdated').textContent = fallbackData.lastUpdated;
                
                return false;
            }
        }

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('nb-NO', {
                style: 'currency',
                currency: 'NOK',
                maximumFractionDigits: 0
            }).format(amount).replace('NOK', 'kr');
        }

        function formatCompact(amount) {
            if (amount >= 1000000) {
                return (amount / 1000000).toFixed(1) + 'M kr';
            } else if (amount >= 1000) {
                return Math.round(amount / 1000) + 'k kr';
            }
            return formatCurrency(amount);
        }

        function getQuarterStatus(amount, goal) {
            const percentage = (amount / goal) * 100;
            if (amount === 0) return { class: 'status-poor', label: 'Ingen data', percentage: 0 };
            if (percentage >= 110) return { class: 'status-excellent', label: 'Utmerket', percentage };
            if (percentage >= 90) return { class: 'status-good', label: 'Bra', percentage };
            if (percentage >= 70) return { class: 'status-fair', label: 'OK', percentage };
            return { class: 'status-poor', label: 'Under mÃ¥l', percentage };
        }

        function calculateQuarterlyStats(revenueData) {
            const quarters = [
                { name: 'Q1', months: [0, 1, 2], label: 'Jan-Mar', goal: monthlyGoal * 3 },
                { name: 'Q2', months: [3, 4, 5], label: 'Apr-Jun', goal: monthlyGoal * 3 },
                { name: 'Q3', months: [6, 7, 8], label: 'Jul-Sep', goal: monthlyGoal * 3 },
                { name: 'Q4', months: [9, 10, 11], label: 'Okt-Des', goal: monthlyGoal * 3 }
            ];

            return quarters.map(quarter => {
                const total = quarter.months.reduce((sum, monthIdx) => {
                    return sum + (revenueData[months[monthIdx]] || 0);
                }, 0);

                const average = total / 3;
                const status = getQuarterStatus(total, quarter.goal);
                const hasData = quarter.months.some(monthIdx => (revenueData[months[monthIdx]] || 0) > 0);

                return {
                    ...quarter,
                    total,
                    average,
                    status,
                    hasData,
                    months: quarter.months.map(monthIdx => ({
                        name: monthNamesDisplay[monthIdx],
                        value: revenueData[months[monthIdx]] || 0
                    }))
                };
            });
        }

        function renderQuarterlyDashboard(revenueData) {
            const quarters = calculateQuarterlyStats(revenueData);
            
            // ==============================
            // ðŸ”§ FIX: Kun tell mÃ¥nedsverdier
            // ==============================
            const total = months.reduce((sum, month) => sum + (revenueData[month] || 0), 0);
            
            const goalProgress = (total / yearlyGoal) * 100;
            const completedQuarters = quarters.filter(q => q.hasData);
            const bestQuarter = quarters.reduce((best, current) => 
                current.total > best.total ? current : best
            );
            const avgQuarterRevenue = completedQuarters.length > 0 ? 
                completedQuarters.reduce((sum, q) => sum + q.total, 0) / completedQuarters.length : 0;

            // Update quick stats
            document.getElementById('totalRevenue').textContent = formatCompact(total);
            document.getElementById('goalProgress').textContent = Math.round(goalProgress) + '%';
            document.getElementById('bestQuarter').textContent = bestQuarter.name;
            document.getElementById('avgQuarter').textContent = formatCompact(avgQuarterRevenue);

            // Render quarters
            const grid = document.getElementById('quartersGrid');
            grid.innerHTML = quarters.map(quarter => `
                <div class="quarter-card ${quarter.status.class}">
                    <div class="quarter-header">
                        <div>
                            <div class="quarter-name">${quarter.name} 2026</div>
                            <div class="quarter-period">${quarter.label}</div>
                        </div>
                        <div class="quarter-status ${quarter.status.class}">
                            ${quarter.status.label}
                        </div>
                    </div>
                    
                    <div class="quarter-total">
                        ${quarter.hasData ? formatCompact(quarter.total) : 'â€”'}
                    </div>
                    
                    <div class="quarter-progress">
                        <div class="quarter-progress-bar" style="width: ${Math.min(quarter.status.percentage, 100)}%"></div>
                    </div>
                    
                    <div class="quarter-details">
                        <span>Snitt: ${quarter.hasData ? formatCompact(quarter.average) : 'â€”'}</span>
                        <span>${quarter.hasData ? Math.round(quarter.status.percentage) + '% av mÃ¥l' : 'Ingen data'}</span>
                    </div>
                    
                    <div class="quarter-months">
                        ${quarter.months.map(month => `
                            <div class="quarter-month">
                                <div class="quarter-month-name">${month.name}</div>
                                <div class="quarter-month-value">
                                    ${month.value > 0 ? formatCompact(month.value) : 'â€”'}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function hideLoadingAndShowContent() {
            document.getElementById('loadingMessage').style.display = 'none';
            document.getElementById('quickStats').style.display = 'grid';
            document.getElementById('quartersGrid').style.display = 'grid';
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                const dataLoaded = await loadRevenueData();
                if (!dataLoaded) {
                    showError('Kunne ikke laste data fra JSON-fil. Bruker fallback-data.');
                }
                renderQuarterlyDashboard(revenueData);
                hideLoadingAndShowContent();
            } catch (error) {
                console.error('Critical error initializing dashboard:', error);
                showError('Kritisk feil ved initialisering av dashboard.');
            }
        });
    </script>
</body>
</html>
